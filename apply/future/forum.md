# W3OS, your Web3.0 entry

- W3OS is an Operation System for Web3.0 base on Polkadot, a pallet called **[Anchor Pallet](https://github.com/ff13dfly/Anchor)** needed.

- W3OS是一个基于Polkadot的全链Web3.0操作系统，基于Polkadot的Anchor Network只多了一个Anchor Pallet（该Pallet也获得了Web3 Foundation的Grants）来支持链上域名系统及存储。W3OS以简洁易用为设计原则，致力于降低开发者和使用者的使用Web3.0的门槛。

- W3OS的目标是让用户和开发者都受益，关键是如何做到这点呢？ 下面从两个角度来说明这个问题，一方面是开发者，一方面是使用者。

- 对于开发者，W3OS具备以下优势
    1. 一站式的全Web3.0访问接入
    2. 精简统一的API访问体验
    3. 不可篡改的链上Dapp发布
    4. 广大的用户基数

- 对于使用者，W3OS具备以下优势
    1. 从免费开始体验Web3.0，完全去中心化的系统
    2. 极低的使用门槛
    3. 安全可信的执行Dapp

- 随着多链时代的到来，链互联也出现了新的变化，W3OS认为链的互通，除了像Polkadot这样的基于链系统本身的互通互联，链上Dapp对多链的功能整合也是一种方式。就像Web2.0那样，一个应用系统，使用不同类型的数据库系统来满足不同的应用需求，也能完美的运行起来。

- 物理性安全，区块链网络本身具有很高的安全性，但是对于服务器本身而言，还是存在被摧毁的风险。现实也浮现出了一个解决方案，只需要把部分网络节点部署到太空，就可以解决这个问题。W3OS作为一个可以加载Dapp的系统，当开发者将Dapp部署到W3OS也就具备了物理性的安全。从成本角度来看，这是一个划算的事情，开发者只需要很少的成本，就可以实现把自己的Dapp部署到太空，具有无法摧毁的安全性。W3OS将开始这方面的调研工作，找到实现这个目标的方案。

## W3OS系统构成

- W3OS主要由3部分组成：Anchor Network，W3API和UI，而W3API和UI都是全链部署在Anchor Network，这样，W3OS就是一个全链的Web3.0操作系统了。

- Anchor Network只增加了一个Pallet来实现W3OS的所有功能，就是Anchor Pallet，这是一个Key-value的链上存储组件，很清晰的把链上资源给组织好，并具备很强的定制能力，也就能实现多种不同的协议。

- W3API是W3OS的核心组件，通过调用链上的SDK库的方式，在保持自身精简的同时，支持广泛的不同Web3.0网络访问能力。

- W3OS支持多种Dapps部署方式，一是可以直接将现有Dapp通过转换的方式部署到链上，二是提供Capp的开发方式，创建更安全的链上应用。

- W3OS的UI部分，针对不同的使用群体进行单独开发。目前规划中有3个版本。

### Anchor Network

- 当前，单节点的测试网络已经上线，可以通过以下节点进行访问。同时，部署在Tanssi的节点也可以进行测试。

- Anchor Network只是增加了Anchor Pallet，其他Polkadot原生具有的功能都存在，这就方便了它便利的接入波卡生态，和其他平行链进行链级别的跨链互操作。

- Anchor Network具备存储小量自定义数据的能力，能完整的实现链上的读写，可以用作重要数据的存储，例如，Dapp的UI前端，各种配置文件。

### W3API

- W3OS主要功能实现的组件，W3API同时支持前端和后端（基于NodeJS）。W3API以从Anchor Network动态加载其他Web3.0网络的SDK的方式，来实现多链连接和使用。这样也能保持自身的精简，便利开发者进行集成。  ****这里最好给个例子****

- W3API是可以进行扩展的Web3.0的功能集合，其自身也是被部署在Anchor Network上的。
![需要补充结构说明图](imgs/structure.png)

#### 核心功能

- 全链部署，是W3API的一个显著特点，无论是W3API自身，还是其引用的各种JS的SDK，都通过Anchor的方式部署在链上，这样，就没有被篡改的风险。同时，只要你连上了Anchor Network，就能连接到整个Web3.0的世界。

- 访问权限控制。控制的逻辑是 Anchor Link 对API中单一功能的使用，需要获取到用户的同意。

- Anchor Network完全访问能力，包括读取和写入，设置Anchor的销售状态。

- 提供对Chain Application（Capp）的支持。提供一个独立W3API精简版供Capp使用，实现对Capp的沙箱隔离。

#### 连接管理功能

- 对外部的节点连接进行统一管理，可以进行权限控制。避免对同一节点反复连接。

- 连接的自动保持功能的实现。Websocket经常性被闪断，需要进行自动重连的管理。可以提供所有连接的状态提示，供前端UI集成到一起进行显示。

- 主流网络的自动化连接的实现。对广泛支持的区块链网络，提供基础的节点信息。例如，BTC、ETH、Solana等。实现的方式是，官方维护Anchor的列表信息，W3API进行调用。

#### 本地安全存储

- 对于用户运行W3OS保存的数据，比如账号信息、权限配置信息等，采用加密（AES）的方式保存在本地。前端采用localStorage保存，后端采用文件的形式来进行保存。

- 本地密码的验证使用如下方式。
  1. 调用本地明文的salt
  2. 和用户输入的password进行md5计算，得到结果
  3. 和本地明文的hash结果进行比较，确认即可

- 本地安全存储也以API的方式提供给其他应用程序使用（注意：这里有安全问题，必须不能暴露加密的hash出来）

- 前端localStorage保存的key值也是通过和密码关联的hash来实现的，进一步降低数据暴露的风险。

#### 账户管理

- 本地SS58账号的保存，保存的是加密后的JSON文件，不保存原始的seed。逻辑如下：
    1. 用户用seed创建账号后，输入password
    2. W3OS本地保存password加密的JSON文件
    3. 用户需要使用时，使用password来解密本地JSON文件，获得链上操作的账号
    4. W3OS本地保存的JSON文件，可以下载保存

- 支持多账号的保存，可以在调用的时候进行选择。以数组的方式提供账号JSON文件的保存，提供增删改查的基础功能。

#### 支付功能

- 基于Anchor Network的支付功能。简单的链上转账功能，提供转账的历史记录信息(需要服务的支持，会单独开发)

- 更多的限制配置，例如，单日最大支付额、黑名单等。

#### 通讯功能

- 基于SS58账号的即时聊天功能，仅需SS58账号即可进行的聊天通讯。基于WebRTC支持点对点的安全加密通讯，实现去中心化的私密聊天。WebRTC还支持点对点的视频聊天，是一个可以深入开发的功能。

- 群组聊天功能。可以通过SS58账号创建群组，实现群聊功能。对群组的管理功能如下：增删成员，设置群名，更换群主，设置群公告，解散群组，设置黑名单。

- 验证支付功能。改功能用于验证SS58账号具有支付能力，这样在服务器间送消息，就增加了一层防护，防止出现临时的SS58账号冲击群组和乱发消息。

#### 交易及市场

- Anchor Network自己的市场实现。链锚的交易功能，可以对自己所有的Anchor进行售卖。支持销售给指定用户和公开销售。这是Anchor Network内置的市场机制，可以让Anchor Name具备和域名一样的价值。

- 实现对不同区块链网络支付的统一封装，就能通过同一个API调用对不同的网络进行支付操作。将在不同链上的操作结果，以Anchor的方式进行保存，就能实现资产的跨链功能。虽然对比原生的跨链，安全性要降低了不少，但却能满足一些低安全性要求的场景，极大的降低开发难度。

- NFT市场的初步集成，挑选一个进行集成

- 铭文市场的初步集成，挑选一个进行集成

#### 扩展功能

- 转换器（仅后端支持）。实现将React项目部署上Anchor Network的功能，实现一条命令部署到链上。该功能可以极大的降低现有Dapp部署到Anchor Network上来，UI部分几乎不需要改动，就能部署，方便项目进行转移。

- 加载器。启动部署在链上的程序，前后端都进行支持。前端的加载器，可加载Dapp到指定的Dom。后端的加载器，可以直接加载链上程序。

    ```bash
        # 后端运行链上程序的方式
        W3.util.xloader ANCHOR_LINK

        # 前端运行链上程序的方式
        W3.util.xloader( ANCHOR_LINK, DOM_ID ) 
    ```

- 下载器。将链上程序保存成单一文件。主要功能是安全的获取到链上程序，可以从本地运行，不需要能访问的部署节点，就能直接的连接到Web3.0的世界。是Loader的一个补充。

### UI

- 和W3API完全分离，完全松耦合，可以实现多种不同的版本。

#### 桌面版本

- 基于W3API的桌面W3OS，主要面向开发者，可以提供对数据的深入检测和查看。

- 基于React开发，也可以部署到Anchor Network上。前端数据库采用IndexedDB，保存聊天记录、交易记录等数据量较大的数据。使用localstorage来保存key-value类型的数据，该类型数据都会AES加密后保存。

- 提供开发者需要的转换器和加载器等工具。

#### 移动版本

- 基于W3API的移动端W3OS，主要面向普通用户。对现有版本进行升级改造的来，更好的实现当前的功能，增加转账历史等新添加的功能。

- 前端数据库采用IndexedDB，保存聊天记录、交易记录等数据量较大的数据。使用localstorage来保存key-value类型的数据，无论key还是value数据都会AES加密后保存。

- 优化Dapp加载的UI，使用让用户更能理解的图像方式，来替代目前类似命令行的输出。

#### Bash版本

- 基于W3API的Bash版本W3OS，主要面向开发者。提供命令行的使用体验，对各项功能进行细致的提示辅助。

- Bash版本可以运行在多种终端，使用loader的方式来进行加载。

- 使用转译的方式来支持命令行的方式进行W3API的调用，例如：

    ```Bash
        #程序的调用方式
        W3.call(["contact","friend","list"],(list)=>{

        });

        #Shell的调用方式
        friend --list
    ```

### 其他支持程序

#### IMGC服务

- 链上部署的IMGC服务器，NodeJS版本。

- 群聊功能的实现。创建群组、修改群组成员、设置群名、修改群主、设置群公告、设置黑明单、解散群组。

- 支付验证的功能。服务器给出一个指定金额给客户端以及转账账户，客户端成功向该账户支付了指定金额，既可验证成功。服务器端将共享该交易给其他服务器，作为账户合法的验证信息。

#### 账单服务

- 链上部署的账户交易流水版本，NodeJS版本。

- 程序启动后，开始监听网络新的区块生成，记录新的交易。同时，对历史数据进行遍历，获取所有的交易记录，进行缓存。

- 客户端通过API传递账号来获取完整的交易记录

#### 加载器 Loader

- 不同与W3API集成的相应功能，这里是独立的Loader文件，可以用于快速部署服务器或者服务节点。

- 前端加载器，html文件，可以通过Anchor Link来加载数据或程序。这次需要对UI进行调整，可以看到完整的进度。

- 后端加载器，js文件。可以通过Anchor Link来加载数据或程序。字符输出结果。

#### 下载器 Downloader

- 只需确保您能有Loader，Downloader中任何一个工具，连接上Anchor Network就能得到正确的程序，这也是对安全的额一种保障。

#### 服务管理工具

- 通用的服务管理器，可以对IMGC和账单服务进行管理。这次申请，将明确该部分的功能，下一步深入开发。

- 采用加密文件上传的方式来进行验证。将加密的JSON上传到服务器后，服务器通过密码进行解析，和启动的SS58账号进行比对，来判断是否具有访问的权限。

- 未来，其他的W3OS基础服务也是采用此管理器进行。