var d=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var D=d((yn,dt)=>{"use strict";dt.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var re=d((Sn,ye)=>{"use strict";var{EMPTY_BUFFER:Gr}=D(),Ae=Buffer[Symbol.species];function jr(e,t){if(e.length===0)return Gr;if(e.length===1)return e[0];let r=Buffer.allocUnsafe(t),s=0;for(let n=0;n<e.length;n++){let i=e[n];r.set(i,s),s+=i.length}return s<t?new Ae(r.buffer,r.byteOffset,s):r}function _t(e,t,r,s,n){for(let i=0;i<n;i++)r[s+i]=e[i]^t[i&3]}function pt(e,t){for(let r=0;r<e.length;r++)e[r]^=t[r&3]}function Vr(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)}function De(e){if(De.readOnly=!0,Buffer.isBuffer(e))return e;let t;return e instanceof ArrayBuffer?t=new Ae(e):ArrayBuffer.isView(e)?t=new Ae(e.buffer,e.byteOffset,e.byteLength):(t=Buffer.from(e),De.readOnly=!1),t}ye.exports={concat:jr,mask:_t,toArrayBuffer:Vr,toBuffer:De,unmask:pt};if(!process.env.WS_NO_BUFFER_UTIL)try{let e=require("bufferutil");ye.exports.mask=function(t,r,s,n,i){i<48?_t(t,r,s,n,i):e.mask(t,r,s,n,i)},ye.exports.unmask=function(t,r){t.length<32?pt(t,r):e.unmask(t,r)}}catch{}});var yt=d((xn,gt)=>{"use strict";var mt=Symbol("kDone"),Me=Symbol("kRun"),Be=class{constructor(t){this[mt]=()=>{this.pending--,this[Me]()},this.concurrency=t||1/0,this.jobs=[],this.pending=0}add(t){this.jobs.push(t),this[Me]()}[Me](){if(this.pending!==this.concurrency&&this.jobs.length){let t=this.jobs.shift();this.pending++,t(this[mt])}}};gt.exports=Be});var ie=d((vn,Et)=>{"use strict";var se=require("zlib"),St=re(),Jr=yt(),{kStatusCode:xt}=D(),Hr=Buffer[Symbol.species],zr=Buffer.from([0,0,255,255]),ve=Symbol("permessage-deflate"),L=Symbol("total-length"),ne=Symbol("callback"),M=Symbol("buffers"),xe=Symbol("error"),Se,qe=class{constructor(t,r,s){if(this._maxPayload=s|0,this._options=t||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!r,this._deflate=null,this._inflate=null,this.params=null,!Se){let n=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Se=new Jr(n)}}static get extensionName(){return"permessage-deflate"}offer(){let t={};return this._options.serverNoContextTakeover&&(t.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(t.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(t.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?t.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(t.client_max_window_bits=!0),t}accept(t){return t=this.normalizeParams(t),this.params=this._isServer?this.acceptAsServer(t):this.acceptAsClient(t),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let t=this._deflate[ne];this._deflate.close(),this._deflate=null,t&&t(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(t){let r=this._options,s=t.find(n=>!(r.serverNoContextTakeover===!1&&n.server_no_context_takeover||n.server_max_window_bits&&(r.serverMaxWindowBits===!1||typeof r.serverMaxWindowBits=="number"&&r.serverMaxWindowBits>n.server_max_window_bits)||typeof r.clientMaxWindowBits=="number"&&!n.client_max_window_bits));if(!s)throw new Error("None of the extension offers can be accepted");return r.serverNoContextTakeover&&(s.server_no_context_takeover=!0),r.clientNoContextTakeover&&(s.client_no_context_takeover=!0),typeof r.serverMaxWindowBits=="number"&&(s.server_max_window_bits=r.serverMaxWindowBits),typeof r.clientMaxWindowBits=="number"?s.client_max_window_bits=r.clientMaxWindowBits:(s.client_max_window_bits===!0||r.clientMaxWindowBits===!1)&&delete s.client_max_window_bits,s}acceptAsClient(t){let r=t[0];if(this._options.clientNoContextTakeover===!1&&r.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!r.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(r.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&r.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return r}normalizeParams(t){return t.forEach(r=>{Object.keys(r).forEach(s=>{let n=r[s];if(n.length>1)throw new Error(`Parameter "${s}" must have only a single value`);if(n=n[0],s==="client_max_window_bits"){if(n!==!0){let i=+n;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${s}": ${n}`);n=i}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${s}": ${n}`)}else if(s==="server_max_window_bits"){let i=+n;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${s}": ${n}`);n=i}else if(s==="client_no_context_takeover"||s==="server_no_context_takeover"){if(n!==!0)throw new TypeError(`Invalid value for parameter "${s}": ${n}`)}else throw new Error(`Unknown parameter "${s}"`);r[s]=n})}),t}decompress(t,r,s){Se.add(n=>{this._decompress(t,r,(i,o)=>{n(),s(i,o)})})}compress(t,r,s){Se.add(n=>{this._compress(t,r,(i,o)=>{n(),s(i,o)})})}_decompress(t,r,s){let n=this._isServer?"client":"server";if(!this._inflate){let i=`${n}_max_window_bits`,o=typeof this.params[i]!="number"?se.Z_DEFAULT_WINDOWBITS:this.params[i];this._inflate=se.createInflateRaw({...this._options.zlibInflateOptions,windowBits:o}),this._inflate[ve]=this,this._inflate[L]=0,this._inflate[M]=[],this._inflate.on("error",Xr),this._inflate.on("data",vt)}this._inflate[ne]=s,this._inflate.write(t),r&&this._inflate.write(zr),this._inflate.flush(()=>{let i=this._inflate[xe];if(i){this._inflate.close(),this._inflate=null,s(i);return}let o=St.concat(this._inflate[M],this._inflate[L]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[L]=0,this._inflate[M]=[],r&&this.params[`${n}_no_context_takeover`]&&this._inflate.reset()),s(null,o)})}_compress(t,r,s){let n=this._isServer?"server":"client";if(!this._deflate){let i=`${n}_max_window_bits`,o=typeof this.params[i]!="number"?se.Z_DEFAULT_WINDOWBITS:this.params[i];this._deflate=se.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:o}),this._deflate[L]=0,this._deflate[M]=[],this._deflate.on("data",Yr)}this._deflate[ne]=s,this._deflate.write(t),this._deflate.flush(se.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let i=St.concat(this._deflate[M],this._deflate[L]);r&&(i=new Hr(i.buffer,i.byteOffset,i.length-4)),this._deflate[ne]=null,this._deflate[L]=0,this._deflate[M]=[],r&&this.params[`${n}_no_context_takeover`]&&this._deflate.reset(),s(null,i)})}};Et.exports=qe;function Yr(e){this[M].push(e),this[L]+=e.length}function vt(e){if(this[L]+=e.length,this[ve]._maxPayload<1||this[L]<=this[ve]._maxPayload){this[M].push(e);return}this[xe]=new RangeError("Max payload size exceeded"),this[xe].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[xe][xt]=1009,this.removeListener("data",vt),this.reset()}function Xr(e){this[ve]._inflate=null,e[xt]=1007,this[ne](e)}});var oe=d((En,Ee)=>{"use strict";var{isUtf8:bt}=require("buffer"),Kr=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Zr(e){return e>=1e3&&e<=1014&&e!==1004&&e!==1005&&e!==1006||e>=3e3&&e<=4999}function Fe(e){let t=e.length,r=0;for(;r<t;)if(!(e[r]&128))r++;else if((e[r]&224)===192){if(r+1===t||(e[r+1]&192)!==128||(e[r]&254)===192)return!1;r+=2}else if((e[r]&240)===224){if(r+2>=t||(e[r+1]&192)!==128||(e[r+2]&192)!==128||e[r]===224&&(e[r+1]&224)===128||e[r]===237&&(e[r+1]&224)===160)return!1;r+=3}else if((e[r]&248)===240){if(r+3>=t||(e[r+1]&192)!==128||(e[r+2]&192)!==128||(e[r+3]&192)!==128||e[r]===240&&(e[r+1]&240)===128||e[r]===244&&e[r+1]>143||e[r]>244)return!1;r+=4}else return!1;return!0}Ee.exports={isValidStatusCode:Zr,isValidUTF8:Fe,tokenChars:Kr};if(bt)Ee.exports.isValidUTF8=function(e){return e.length<24?Fe(e):bt(e)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let e=require("utf-8-validate");Ee.exports.isValidUTF8=function(t){return t.length<32?Fe(t):e(t)}}catch{}});var Ve=d((bn,Pt)=>{"use strict";var{Writable:Qr}=require("stream"),Nt=ie(),{BINARY_TYPES:es,EMPTY_BUFFER:Tt,kStatusCode:ts,kWebSocket:rs}=D(),{concat:We,toArrayBuffer:ss,unmask:ns}=re(),{isValidStatusCode:is,isValidUTF8:Ot}=oe(),be=Buffer[Symbol.species],os=Promise.resolve(),as=typeof queueMicrotask=="function"?queueMicrotask:ls,Y=0,wt=1,kt=2,Ct=3,$e=4,It=5,Ge=6,je=class extends Qr{constructor(t={}){super(),this._binaryType=t.binaryType||es[0],this._extensions=t.extensions||{},this._isServer=!!t.isServer,this._maxPayload=t.maxPayload|0,this._skipUTF8Validation=!!t.skipUTF8Validation,this[rs]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=Y,this._loop=!1}_write(t,r,s){if(this._opcode===8&&this._state==Y)return s();this._bufferedBytes+=t.length,this._buffers.push(t),this.startLoop(s)}consume(t){if(this._bufferedBytes-=t,t===this._buffers[0].length)return this._buffers.shift();if(t<this._buffers[0].length){let s=this._buffers[0];return this._buffers[0]=new be(s.buffer,s.byteOffset+t,s.length-t),new be(s.buffer,s.byteOffset,t)}let r=Buffer.allocUnsafe(t);do{let s=this._buffers[0],n=r.length-t;t>=s.length?r.set(this._buffers.shift(),n):(r.set(new Uint8Array(s.buffer,s.byteOffset,t),n),this._buffers[0]=new be(s.buffer,s.byteOffset+t,s.length-t)),t-=s.length}while(t>0);return r}startLoop(t){let r;this._loop=!0;do switch(this._state){case Y:r=this.getInfo();break;case wt:r=this.getPayloadLength16();break;case kt:r=this.getPayloadLength64();break;case Ct:this.getMask();break;case $e:r=this.getData(t);break;case It:this._loop=!1;return;default:this._loop=!1,as(()=>{this._state=Y,this.startLoop(t)});return}while(this._loop);t(r)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}let t=this.consume(2);if(t[0]&48)return this._loop=!1,g(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");let r=(t[0]&64)===64;if(r&&!this._extensions[Nt.extensionName])return this._loop=!1,g(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=(t[0]&128)===128,this._opcode=t[0]&15,this._payloadLength=t[1]&127,this._opcode===0){if(r)return this._loop=!1,g(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,g(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,g(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=r}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,g(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(r)return this._loop=!1,g(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1)return this._loop=!1,g(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}else return this._loop=!1,g(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(t[1]&128)===128,this._isServer){if(!this._masked)return this._loop=!1,g(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,g(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(this._payloadLength===126)this._state=wt;else if(this._payloadLength===127)this._state=kt;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}let t=this.consume(8),r=t.readUInt32BE(0);return r>Math.pow(2,53-32)-1?(this._loop=!1,g(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=r*Math.pow(2,32)+t.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,g(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=Ct:this._state=$e}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=$e}getData(t){let r=Tt;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}r=this.consume(this._payloadLength),this._masked&&this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3]&&ns(r,this._mask)}if(this._opcode>7)return this.controlMessage(r);if(this._compressed){this._state=It,this.decompress(r,t);return}return r.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(r)),this.dataMessage()}decompress(t,r){this._extensions[Nt.extensionName].decompress(t,this._fin,(n,i)=>{if(n)return r(n);if(i.length){if(this._messageLength+=i.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return r(g(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(i)}let o=this.dataMessage();if(o)return r(o);this.startLoop(r)})}dataMessage(){if(this._fin){let t=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let s;this._binaryType==="nodebuffer"?s=We(r,t):this._binaryType==="arraybuffer"?s=ss(We(r,t)):s=r,this.emit("message",s,!0)}else{let s=We(r,t);if(!this._skipUTF8Validation&&!Ot(s))return this._loop=!1,g(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",s,!1)}}this._state=Ge}controlMessage(t){if(this._opcode===8)if(this._loop=!1,t.length===0)this.emit("conclude",1005,Tt),this.end(),this._state=Y;else{let r=t.readUInt16BE(0);if(!is(r))return g(RangeError,`invalid status code ${r}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");let s=new be(t.buffer,t.byteOffset+2,t.length-2);if(!this._skipUTF8Validation&&!Ot(s))return g(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",r,s),this.end(),this._state=Y}else this._opcode===9?(this.emit("ping",t),this._state=Ge):(this.emit("pong",t),this._state=Ge)}};Pt.exports=je;function g(e,t,r,s,n){let i=new e(r?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(i,g),i.code=n,i[ts]=s,i}function ls(e){os.then(e).catch(fs)}function cs(e){throw e}function fs(e){process.nextTick(cs,e)}});var He=d((Tn,Rt)=>{"use strict";var{Duplex:Nn}=require("stream"),{randomFillSync:us}=require("crypto"),Lt=ie(),{EMPTY_BUFFER:hs}=D(),{isValidStatusCode:ds}=oe(),{mask:Ut,toBuffer:X}=re(),w=Symbol("kByteLength"),_s=Buffer.alloc(4),Je=class e{constructor(t,r,s){this._extensions=r||{},s&&(this._generateMask=s,this._maskBuffer=Buffer.alloc(4)),this._socket=t,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(t,r){let s,n=!1,i=2,o=!1;r.mask&&(s=r.maskBuffer||_s,r.generateMask?r.generateMask(s):us(s,0,4),o=(s[0]|s[1]|s[2]|s[3])===0,i=6);let a;typeof t=="string"?(!r.mask||o)&&r[w]!==void 0?a=r[w]:(t=Buffer.from(t),a=t.length):(a=t.length,n=r.mask&&r.readOnly&&!o);let c=a;a>=65536?(i+=8,c=127):a>125&&(i+=2,c=126);let l=Buffer.allocUnsafe(n?a+i:i);return l[0]=r.fin?r.opcode|128:r.opcode,r.rsv1&&(l[0]|=64),l[1]=c,c===126?l.writeUInt16BE(a,2):c===127&&(l[2]=l[3]=0,l.writeUIntBE(a,4,6)),r.mask?(l[1]|=128,l[i-4]=s[0],l[i-3]=s[1],l[i-2]=s[2],l[i-1]=s[3],o?[l,t]:n?(Ut(t,s,l,i,a),[l]):(Ut(t,s,t,0,a),[l,t])):[l,t]}close(t,r,s,n){let i;if(t===void 0)i=hs;else{if(typeof t!="number"||!ds(t))throw new TypeError("First argument must be a valid error code number");if(r===void 0||!r.length)i=Buffer.allocUnsafe(2),i.writeUInt16BE(t,0);else{let a=Buffer.byteLength(r);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");i=Buffer.allocUnsafe(2+a),i.writeUInt16BE(t,0),typeof r=="string"?i.write(r,2):i.set(r,2)}}let o={[w]:i.length,fin:!0,generateMask:this._generateMask,mask:s,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._deflating?this.enqueue([this.dispatch,i,!1,o,n]):this.sendFrame(e.frame(i,o),n)}ping(t,r,s){let n,i;if(typeof t=="string"?(n=Buffer.byteLength(t),i=!1):(t=X(t),n=t.length,i=X.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[w]:n,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};this._deflating?this.enqueue([this.dispatch,t,!1,o,s]):this.sendFrame(e.frame(t,o),s)}pong(t,r,s){let n,i;if(typeof t=="string"?(n=Buffer.byteLength(t),i=!1):(t=X(t),n=t.length,i=X.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[w]:n,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};this._deflating?this.enqueue([this.dispatch,t,!1,o,s]):this.sendFrame(e.frame(t,o),s)}send(t,r,s){let n=this._extensions[Lt.extensionName],i=r.binary?2:1,o=r.compress,a,c;if(typeof t=="string"?(a=Buffer.byteLength(t),c=!1):(t=X(t),a=t.length,c=X.readOnly),this._firstFragment?(this._firstFragment=!1,o&&n&&n.params[n._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(o=a>=n._threshold),this._compress=o):(o=!1,i=0),r.fin&&(this._firstFragment=!0),n){let l={[w]:a,fin:r.fin,generateMask:this._generateMask,mask:r.mask,maskBuffer:this._maskBuffer,opcode:i,readOnly:c,rsv1:o};this._deflating?this.enqueue([this.dispatch,t,this._compress,l,s]):this.dispatch(t,this._compress,l,s)}else this.sendFrame(e.frame(t,{[w]:a,fin:r.fin,generateMask:this._generateMask,mask:r.mask,maskBuffer:this._maskBuffer,opcode:i,readOnly:c,rsv1:!1}),s)}dispatch(t,r,s,n){if(!r){this.sendFrame(e.frame(t,s),n);return}let i=this._extensions[Lt.extensionName];this._bufferedBytes+=s[w],this._deflating=!0,i.compress(t,s.fin,(o,a)=>{if(this._socket.destroyed){let c=new Error("The socket was closed while data was being compressed");typeof n=="function"&&n(c);for(let l=0;l<this._queue.length;l++){let f=this._queue[l],u=f[f.length-1];typeof u=="function"&&u(c)}return}this._bufferedBytes-=s[w],this._deflating=!1,s.readOnly=!1,this.sendFrame(e.frame(a,s),n),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let t=this._queue.shift();this._bufferedBytes-=t[3][w],Reflect.apply(t[0],this,t.slice(1))}}enqueue(t){this._bufferedBytes+=t[3][w],this._queue.push(t)}sendFrame(t,r){t.length===2?(this._socket.cork(),this._socket.write(t[0]),this._socket.write(t[1],r),this._socket.uncork()):this._socket.write(t[0],r)}};Rt.exports=Je});var Gt=d((On,$t)=>{"use strict";var{kForOnEventAttribute:ae,kListener:ze}=D(),At=Symbol("kCode"),Dt=Symbol("kData"),Mt=Symbol("kError"),Bt=Symbol("kMessage"),qt=Symbol("kReason"),K=Symbol("kTarget"),Ft=Symbol("kType"),Wt=Symbol("kWasClean"),U=class{constructor(t){this[K]=null,this[Ft]=t}get target(){return this[K]}get type(){return this[Ft]}};Object.defineProperty(U.prototype,"target",{enumerable:!0});Object.defineProperty(U.prototype,"type",{enumerable:!0});var F=class extends U{constructor(t,r={}){super(t),this[At]=r.code===void 0?0:r.code,this[qt]=r.reason===void 0?"":r.reason,this[Wt]=r.wasClean===void 0?!1:r.wasClean}get code(){return this[At]}get reason(){return this[qt]}get wasClean(){return this[Wt]}};Object.defineProperty(F.prototype,"code",{enumerable:!0});Object.defineProperty(F.prototype,"reason",{enumerable:!0});Object.defineProperty(F.prototype,"wasClean",{enumerable:!0});var Z=class extends U{constructor(t,r={}){super(t),this[Mt]=r.error===void 0?null:r.error,this[Bt]=r.message===void 0?"":r.message}get error(){return this[Mt]}get message(){return this[Bt]}};Object.defineProperty(Z.prototype,"error",{enumerable:!0});Object.defineProperty(Z.prototype,"message",{enumerable:!0});var le=class extends U{constructor(t,r={}){super(t),this[Dt]=r.data===void 0?null:r.data}get data(){return this[Dt]}};Object.defineProperty(le.prototype,"data",{enumerable:!0});var ps={addEventListener(e,t,r={}){for(let n of this.listeners(e))if(!r[ae]&&n[ze]===t&&!n[ae])return;let s;if(e==="message")s=function(i,o){let a=new le("message",{data:o?i:i.toString()});a[K]=this,Ne(t,this,a)};else if(e==="close")s=function(i,o){let a=new F("close",{code:i,reason:o.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[K]=this,Ne(t,this,a)};else if(e==="error")s=function(i){let o=new Z("error",{error:i,message:i.message});o[K]=this,Ne(t,this,o)};else if(e==="open")s=function(){let i=new U("open");i[K]=this,Ne(t,this,i)};else return;s[ae]=!!r[ae],s[ze]=t,r.once?this.once(e,s):this.on(e,s)},removeEventListener(e,t){for(let r of this.listeners(e))if(r[ze]===t&&!r[ae]){this.removeListener(e,r);break}}};$t.exports={CloseEvent:F,ErrorEvent:Z,Event:U,EventTarget:ps,MessageEvent:le};function Ne(e,t,r){typeof e=="object"&&e.handleEvent?e.handleEvent.call(e,r):e.call(t,r)}});var Ye=d((wn,jt)=>{"use strict";var{tokenChars:ce}=oe();function k(e,t,r){e[t]===void 0?e[t]=[r]:e[t].push(r)}function ms(e){let t=Object.create(null),r=Object.create(null),s=!1,n=!1,i=!1,o,a,c=-1,l=-1,f=-1,u=0;for(;u<e.length;u++)if(l=e.charCodeAt(u),o===void 0)if(f===-1&&ce[l]===1)c===-1&&(c=u);else if(u!==0&&(l===32||l===9))f===-1&&c!==-1&&(f=u);else if(l===59||l===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${u}`);f===-1&&(f=u);let E=e.slice(c,f);l===44?(k(t,E,r),r=Object.create(null)):o=E,c=f=-1}else throw new SyntaxError(`Unexpected character at index ${u}`);else if(a===void 0)if(f===-1&&ce[l]===1)c===-1&&(c=u);else if(l===32||l===9)f===-1&&c!==-1&&(f=u);else if(l===59||l===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${u}`);f===-1&&(f=u),k(r,e.slice(c,f),!0),l===44&&(k(t,o,r),r=Object.create(null),o=void 0),c=f=-1}else if(l===61&&c!==-1&&f===-1)a=e.slice(c,u),c=f=-1;else throw new SyntaxError(`Unexpected character at index ${u}`);else if(n){if(ce[l]!==1)throw new SyntaxError(`Unexpected character at index ${u}`);c===-1?c=u:s||(s=!0),n=!1}else if(i)if(ce[l]===1)c===-1&&(c=u);else if(l===34&&c!==-1)i=!1,f=u;else if(l===92)n=!0;else throw new SyntaxError(`Unexpected character at index ${u}`);else if(l===34&&e.charCodeAt(u-1)===61)i=!0;else if(f===-1&&ce[l]===1)c===-1&&(c=u);else if(c!==-1&&(l===32||l===9))f===-1&&(f=u);else if(l===59||l===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${u}`);f===-1&&(f=u);let E=e.slice(c,f);s&&(E=E.replace(/\\/g,""),s=!1),k(r,a,E),l===44&&(k(t,o,r),r=Object.create(null),o=void 0),a=void 0,c=f=-1}else throw new SyntaxError(`Unexpected character at index ${u}`);if(c===-1||i||l===32||l===9)throw new SyntaxError("Unexpected end of input");f===-1&&(f=u);let m=e.slice(c,f);return o===void 0?k(t,m,r):(a===void 0?k(r,m,!0):s?k(r,a,m.replace(/\\/g,"")):k(r,a,m),k(t,o,r)),t}function gs(e){return Object.keys(e).map(t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map(s=>[t].concat(Object.keys(s).map(n=>{let i=s[n];return Array.isArray(i)||(i=[i]),i.map(o=>o===!0?n:`${n}=${o}`).join("; ")})).join("; ")).join(", ")}).join(", ")}jt.exports={format:gs,parse:ms}});var et=d((In,tr)=>{"use strict";var ys=require("events"),Ss=require("https"),xs=require("http"),Ht=require("net"),vs=require("tls"),{randomBytes:Es,createHash:bs}=require("crypto"),{Duplex:kn,Readable:Cn}=require("stream"),{URL:Xe}=require("url"),B=ie(),Ns=Ve(),Ts=He(),{BINARY_TYPES:Vt,EMPTY_BUFFER:Te,GUID:Os,kForOnEventAttribute:Ke,kListener:ws,kStatusCode:ks,kWebSocket:x,NOOP:zt}=D(),{EventTarget:{addEventListener:Cs,removeEventListener:Is}}=Gt(),{format:Ps,parse:Ls}=Ye(),{toBuffer:Us}=re(),Rs=30*1e3,Yt=Symbol("kAborted"),Ze=[8,13],R=["CONNECTING","OPEN","CLOSING","CLOSED"],As=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,_=class e extends ys{constructor(t,r,s){super(),this._binaryType=Vt[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=Te,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=e.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,t!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,r===void 0?r=[]:Array.isArray(r)||(typeof r=="object"&&r!==null?(s=r,r=[]):r=[r]),Xt(this,t,r,s)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(t){Vt.includes(t)&&(this._binaryType=t,this._receiver&&(this._receiver._binaryType=t))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(t,r,s){let n=new Ns({binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:s.maxPayload,skipUTF8Validation:s.skipUTF8Validation});this._sender=new Ts(t,this._extensions,s.generateMask),this._receiver=n,this._socket=t,n[x]=this,t[x]=this,n.on("conclude",Bs),n.on("drain",qs),n.on("error",Fs),n.on("message",Ws),n.on("ping",$s),n.on("pong",Gs),t.setTimeout&&t.setTimeout(0),t.setNoDelay&&t.setNoDelay(),r.length>0&&t.unshift(r),t.on("close",Zt),t.on("data",we),t.on("end",Qt),t.on("error",er),this._readyState=e.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=e.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[B.extensionName]&&this._extensions[B.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=e.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(t,r){if(this.readyState!==e.CLOSED){if(this.readyState===e.CONNECTING){let s="WebSocket was closed before the connection was established";T(this,this._req,s);return}if(this.readyState===e.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=e.CLOSING,this._sender.close(t,r,!this._isServer,s=>{s||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),Rs)}}pause(){this.readyState===e.CONNECTING||this.readyState===e.CLOSED||(this._paused=!0,this._socket.pause())}ping(t,r,s){if(this.readyState===e.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof t=="function"?(s=t,t=r=void 0):typeof r=="function"&&(s=r,r=void 0),typeof t=="number"&&(t=t.toString()),this.readyState!==e.OPEN){Qe(this,t,s);return}r===void 0&&(r=!this._isServer),this._sender.ping(t||Te,r,s)}pong(t,r,s){if(this.readyState===e.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof t=="function"?(s=t,t=r=void 0):typeof r=="function"&&(s=r,r=void 0),typeof t=="number"&&(t=t.toString()),this.readyState!==e.OPEN){Qe(this,t,s);return}r===void 0&&(r=!this._isServer),this._sender.pong(t||Te,r,s)}resume(){this.readyState===e.CONNECTING||this.readyState===e.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(t,r,s){if(this.readyState===e.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"&&(s=r,r={}),typeof t=="number"&&(t=t.toString()),this.readyState!==e.OPEN){Qe(this,t,s);return}let n={binary:typeof t!="string",mask:!this._isServer,compress:!0,fin:!0,...r};this._extensions[B.extensionName]||(n.compress=!1),this._sender.send(t||Te,n,s)}terminate(){if(this.readyState!==e.CLOSED){if(this.readyState===e.CONNECTING){let t="WebSocket was closed before the connection was established";T(this,this._req,t);return}this._socket&&(this._readyState=e.CLOSING,this._socket.destroy())}}};Object.defineProperty(_,"CONNECTING",{enumerable:!0,value:R.indexOf("CONNECTING")});Object.defineProperty(_.prototype,"CONNECTING",{enumerable:!0,value:R.indexOf("CONNECTING")});Object.defineProperty(_,"OPEN",{enumerable:!0,value:R.indexOf("OPEN")});Object.defineProperty(_.prototype,"OPEN",{enumerable:!0,value:R.indexOf("OPEN")});Object.defineProperty(_,"CLOSING",{enumerable:!0,value:R.indexOf("CLOSING")});Object.defineProperty(_.prototype,"CLOSING",{enumerable:!0,value:R.indexOf("CLOSING")});Object.defineProperty(_,"CLOSED",{enumerable:!0,value:R.indexOf("CLOSED")});Object.defineProperty(_.prototype,"CLOSED",{enumerable:!0,value:R.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(e=>{Object.defineProperty(_.prototype,e,{enumerable:!0})});["open","error","close","message"].forEach(e=>{Object.defineProperty(_.prototype,`on${e}`,{enumerable:!0,get(){for(let t of this.listeners(e))if(t[Ke])return t[ws];return null},set(t){for(let r of this.listeners(e))if(r[Ke]){this.removeListener(e,r);break}typeof t=="function"&&this.addEventListener(e,t,{[Ke]:!0})}})});_.prototype.addEventListener=Cs;_.prototype.removeEventListener=Is;tr.exports=_;function Xt(e,t,r,s){let n={protocolVersion:Ze[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...s,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(!Ze.includes(n.protocolVersion))throw new RangeError(`Unsupported protocol version: ${n.protocolVersion} (supported versions: ${Ze.join(", ")})`);let i;if(t instanceof Xe)i=t;else try{i=new Xe(t)}catch{throw new SyntaxError(`Invalid URL: ${t}`)}i.protocol==="http:"?i.protocol="ws:":i.protocol==="https:"&&(i.protocol="wss:"),e._url=i.href;let o=i.protocol==="wss:",a=i.protocol==="ws+unix:",c;if(i.protocol!=="ws:"&&!o&&!a?c=`The URL's protocol must be one of "ws:", "wss:", "http:", "https", or "ws+unix:"`:a&&!i.pathname?c="The URL's pathname is empty":i.hash&&(c="The URL contains a fragment identifier"),c){let h=new SyntaxError(c);if(e._redirects===0)throw h;Oe(e,h);return}let l=o?443:80,f=Es(16).toString("base64"),u=o?Ss.request:xs.request,m=new Set,E;if(n.createConnection=o?Ms:Ds,n.defaultPort=n.defaultPort||l,n.port=i.port||l,n.host=i.hostname.startsWith("[")?i.hostname.slice(1,-1):i.hostname,n.headers={...n.headers,"Sec-WebSocket-Version":n.protocolVersion,"Sec-WebSocket-Key":f,Connection:"Upgrade",Upgrade:"websocket"},n.path=i.pathname+i.search,n.timeout=n.handshakeTimeout,n.perMessageDeflate&&(E=new B(n.perMessageDeflate!==!0?n.perMessageDeflate:{},!1,n.maxPayload),n.headers["Sec-WebSocket-Extensions"]=Ps({[B.extensionName]:E.offer()})),r.length){for(let h of r){if(typeof h!="string"||!As.test(h)||m.has(h))throw new SyntaxError("An invalid or duplicated subprotocol was specified");m.add(h)}n.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(n.origin&&(n.protocolVersion<13?n.headers["Sec-WebSocket-Origin"]=n.origin:n.headers.Origin=n.origin),(i.username||i.password)&&(n.auth=`${i.username}:${i.password}`),a){let h=n.path.split(":");n.socketPath=h[0],n.path=h[1]}let p;if(n.followRedirects){if(e._redirects===0){e._originalIpc=a,e._originalSecure=o,e._originalHostOrSocketPath=a?n.socketPath:i.host;let h=s&&s.headers;if(s={...s,headers:{}},h)for(let[N,z]of Object.entries(h))s.headers[N.toLowerCase()]=z}else if(e.listenerCount("redirect")===0){let h=a?e._originalIpc?n.socketPath===e._originalHostOrSocketPath:!1:e._originalIpc?!1:i.host===e._originalHostOrSocketPath;(!h||e._originalSecure&&!o)&&(delete n.headers.authorization,delete n.headers.cookie,h||delete n.headers.host,n.auth=void 0)}n.auth&&!s.headers.authorization&&(s.headers.authorization="Basic "+Buffer.from(n.auth).toString("base64")),p=e._req=u(n),e._redirects&&e.emit("redirect",e.url,p)}else p=e._req=u(n);n.timeout&&p.on("timeout",()=>{T(e,p,"Opening handshake has timed out")}),p.on("error",h=>{p===null||p[Yt]||(p=e._req=null,Oe(e,h))}),p.on("response",h=>{let N=h.headers.location,z=h.statusCode;if(N&&n.followRedirects&&z>=300&&z<400){if(++e._redirects>n.maxRedirects){T(e,p,"Maximum redirects exceeded");return}p.abort();let ge;try{ge=new Xe(N,t)}catch{let q=new SyntaxError(`Invalid URL: ${N}`);Oe(e,q);return}Xt(e,ge,r,s)}else e.emit("unexpected-response",p,h)||T(e,p,`Unexpected server response: ${h.statusCode}`)}),p.on("upgrade",(h,N,z)=>{if(e.emit("upgrade",h),e.readyState!==_.CONNECTING)return;if(p=e._req=null,h.headers.upgrade.toLowerCase()!=="websocket"){T(e,N,"Invalid Upgrade header");return}let ge=bs("sha1").update(f+Os).digest("base64");if(h.headers["sec-websocket-accept"]!==ge){T(e,N,"Invalid Sec-WebSocket-Accept header");return}let te=h.headers["sec-websocket-protocol"],q;if(te!==void 0?m.size?m.has(te)||(q="Server sent an invalid subprotocol"):q="Server sent a subprotocol but none was requested":m.size&&(q="Server sent no subprotocol"),q){T(e,N,q);return}te&&(e._protocol=te);let ut=h.headers["sec-websocket-extensions"];if(ut!==void 0){if(!E){T(e,N,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let Ue;try{Ue=Ls(ut)}catch{T(e,N,"Invalid Sec-WebSocket-Extensions header");return}let ht=Object.keys(Ue);if(ht.length!==1||ht[0]!==B.extensionName){T(e,N,"Server indicated an extension that was not requested");return}try{E.accept(Ue[B.extensionName])}catch{T(e,N,"Invalid Sec-WebSocket-Extensions header");return}e._extensions[B.extensionName]=E}e.setSocket(N,z,{generateMask:n.generateMask,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation})}),n.finishRequest?n.finishRequest(p,e):p.end()}function Oe(e,t){e._readyState=_.CLOSING,e.emit("error",t),e.emitClose()}function Ds(e){return e.path=e.socketPath,Ht.connect(e)}function Ms(e){return e.path=void 0,!e.servername&&e.servername!==""&&(e.servername=Ht.isIP(e.host)?"":e.host),vs.connect(e)}function T(e,t,r){e._readyState=_.CLOSING;let s=new Error(r);Error.captureStackTrace(s,T),t.setHeader?(t[Yt]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(Oe,e,s)):(t.destroy(s),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function Qe(e,t,r){if(t){let s=Us(t).length;e._socket?e._sender._bufferedBytes+=s:e._bufferedAmount+=s}if(r){let s=new Error(`WebSocket is not open: readyState ${e.readyState} (${R[e.readyState]})`);process.nextTick(r,s)}}function Bs(e,t){let r=this[x];r._closeFrameReceived=!0,r._closeMessage=t,r._closeCode=e,r._socket[x]!==void 0&&(r._socket.removeListener("data",we),process.nextTick(Kt,r._socket),e===1005?r.close():r.close(e,t))}function qs(){let e=this[x];e.isPaused||e._socket.resume()}function Fs(e){let t=this[x];t._socket[x]!==void 0&&(t._socket.removeListener("data",we),process.nextTick(Kt,t._socket),t.close(e[ks])),t.emit("error",e)}function Jt(){this[x].emitClose()}function Ws(e,t){this[x].emit("message",e,t)}function $s(e){let t=this[x];t.pong(e,!t._isServer,zt),t.emit("ping",e)}function Gs(e){this[x].emit("pong",e)}function Kt(e){e.resume()}function Zt(){let e=this[x];this.removeListener("close",Zt),this.removeListener("data",we),this.removeListener("end",Qt),e._readyState=_.CLOSING;let t;!this._readableState.endEmitted&&!e._closeFrameReceived&&!e._receiver._writableState.errorEmitted&&(t=e._socket.read())!==null&&e._receiver.write(t),e._receiver.end(),this[x]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",Jt),e._receiver.on("finish",Jt))}function we(e){this[x]._receiver.write(e)||this.pause()}function Qt(){let e=this[x];e._readyState=_.CLOSING,e._receiver.end(),this.end()}function er(){let e=this[x];this.removeListener("error",er),this.on("error",zt),e&&(e._readyState=_.CLOSING,this.destroy())}});var ir=d((Pn,nr)=>{"use strict";var{Duplex:js}=require("stream");function rr(e){e.emit("close")}function Vs(){!this.destroyed&&this._writableState.finished&&this.destroy()}function sr(e){this.removeListener("error",sr),this.destroy(),this.listenerCount("error")===0&&this.emit("error",e)}function Js(e,t){let r=!0,s=new js({...t,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return e.on("message",function(i,o){let a=!o&&s._readableState.objectMode?i.toString():i;s.push(a)||e.pause()}),e.once("error",function(i){s.destroyed||(r=!1,s.destroy(i))}),e.once("close",function(){s.destroyed||s.push(null)}),s._destroy=function(n,i){if(e.readyState===e.CLOSED){i(n),process.nextTick(rr,s);return}let o=!1;e.once("error",function(c){o=!0,i(c)}),e.once("close",function(){o||i(n),process.nextTick(rr,s)}),r&&e.terminate()},s._final=function(n){if(e.readyState===e.CONNECTING){e.once("open",function(){s._final(n)});return}e._socket!==null&&(e._socket._writableState.finished?(n(),s._readableState.endEmitted&&s.destroy()):(e._socket.once("finish",function(){n()}),e.close()))},s._read=function(){e.isPaused&&e.resume()},s._write=function(n,i,o){if(e.readyState===e.CONNECTING){e.once("open",function(){s._write(n,i,o)});return}e.send(n,o)},s.on("end",Vs),s.on("error",sr),s}nr.exports=Js});var ar=d((Ln,or)=>{"use strict";var{tokenChars:Hs}=oe();function zs(e){let t=new Set,r=-1,s=-1,n=0;for(n;n<e.length;n++){let o=e.charCodeAt(n);if(s===-1&&Hs[o]===1)r===-1&&(r=n);else if(n!==0&&(o===32||o===9))s===-1&&r!==-1&&(s=n);else if(o===44){if(r===-1)throw new SyntaxError(`Unexpected character at index ${n}`);s===-1&&(s=n);let a=e.slice(r,s);if(t.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);t.add(a),r=s=-1}else throw new SyntaxError(`Unexpected character at index ${n}`)}if(r===-1||s!==-1)throw new SyntaxError("Unexpected end of input");let i=e.slice(r,n);if(t.has(i))throw new SyntaxError(`The "${i}" subprotocol is duplicated`);return t.add(i),t}or.exports={parse:zs}});var _r=d((Rn,dr)=>{"use strict";var Ys=require("events"),ke=require("http"),{Duplex:Un}=require("stream"),{createHash:Xs}=require("crypto"),lr=Ye(),W=ie(),Ks=ar(),Zs=et(),{GUID:Qs,kWebSocket:en}=D(),tn=/^[+/0-9A-Za-z]{22}==$/,cr=0,fr=1,hr=2,tt=class extends Ys{constructor(t,r){if(super(),t={maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:Zs,...t},t.port==null&&!t.server&&!t.noServer||t.port!=null&&(t.server||t.noServer)||t.server&&t.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(t.port!=null?(this._server=ke.createServer((s,n)=>{let i=ke.STATUS_CODES[426];n.writeHead(426,{"Content-Length":i.length,"Content-Type":"text/plain"}),n.end(i)}),this._server.listen(t.port,t.host,t.backlog,r)):t.server&&(this._server=t.server),this._server){let s=this.emit.bind(this,"connection");this._removeListeners=rn(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(n,i,o)=>{this.handleUpgrade(n,i,o,s)}})}t.perMessageDeflate===!0&&(t.perMessageDeflate={}),t.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=t,this._state=cr}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(t){if(this._state===hr){t&&this.once("close",()=>{t(new Error("The server is not running"))}),process.nextTick(fe,this);return}if(t&&this.once("close",t),this._state!==fr)if(this._state=fr,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(fe,this):process.nextTick(fe,this);else{let r=this._server;this._removeListeners(),this._removeListeners=this._server=null,r.close(()=>{fe(this)})}}shouldHandle(t){if(this.options.path){let r=t.url.indexOf("?");if((r!==-1?t.url.slice(0,r):t.url)!==this.options.path)return!1}return!0}handleUpgrade(t,r,s,n){r.on("error",ur);let i=t.headers["sec-websocket-key"],o=+t.headers["sec-websocket-version"];if(t.method!=="GET"){$(this,t,r,405,"Invalid HTTP method");return}if(t.headers.upgrade.toLowerCase()!=="websocket"){$(this,t,r,400,"Invalid Upgrade header");return}if(!i||!tn.test(i)){$(this,t,r,400,"Missing or invalid Sec-WebSocket-Key header");return}if(o!==8&&o!==13){$(this,t,r,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(t)){ue(r,400);return}let a=t.headers["sec-websocket-protocol"],c=new Set;if(a!==void 0)try{c=Ks.parse(a)}catch{$(this,t,r,400,"Invalid Sec-WebSocket-Protocol header");return}let l=t.headers["sec-websocket-extensions"],f={};if(this.options.perMessageDeflate&&l!==void 0){let u=new W(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let m=lr.parse(l);m[W.extensionName]&&(u.accept(m[W.extensionName]),f[W.extensionName]=u)}catch{$(this,t,r,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let u={origin:t.headers[`${o===8?"sec-websocket-origin":"origin"}`],secure:!!(t.socket.authorized||t.socket.encrypted),req:t};if(this.options.verifyClient.length===2){this.options.verifyClient(u,(m,E,p,h)=>{if(!m)return ue(r,E||401,p,h);this.completeUpgrade(f,i,c,t,r,s,n)});return}if(!this.options.verifyClient(u))return ue(r,401)}this.completeUpgrade(f,i,c,t,r,s,n)}completeUpgrade(t,r,s,n,i,o,a){if(!i.readable||!i.writable)return i.destroy();if(i[en])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>cr)return ue(i,503);let l=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Xs("sha1").update(r+Qs).digest("base64")}`],f=new this.options.WebSocket(null);if(s.size){let u=this.options.handleProtocols?this.options.handleProtocols(s,n):s.values().next().value;u&&(l.push(`Sec-WebSocket-Protocol: ${u}`),f._protocol=u)}if(t[W.extensionName]){let u=t[W.extensionName].params,m=lr.format({[W.extensionName]:[u]});l.push(`Sec-WebSocket-Extensions: ${m}`),f._extensions=t}this.emit("headers",l,n),i.write(l.concat(`\r
`).join(`\r
`)),i.removeListener("error",ur),f.setSocket(i,o,{maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(f),f.on("close",()=>{this.clients.delete(f),this._shouldEmitClose&&!this.clients.size&&process.nextTick(fe,this)})),a(f,n)}};dr.exports=tt;function rn(e,t){for(let r of Object.keys(t))e.on(r,t[r]);return function(){for(let s of Object.keys(t))e.removeListener(s,t[s])}}function fe(e){e._state=hr,e.emit("close")}function ur(){this.destroy()}function ue(e,t,r,s){r=r||ke.STATUS_CODES[t],s={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...s},e.once("finish",e.destroy),e.end(`HTTP/1.1 ${t} ${ke.STATUS_CODES[t]}\r
`+Object.keys(s).map(n=>`${n}: ${s[n]}`).join(`\r
`)+`\r
\r
`+r)}function $(e,t,r,s,n){if(e.listenerCount("wsClientError")){let i=new Error(n);Error.captureStackTrace(i,$),e.emit("wsClientError",i,r,t)}else ue(r,s,n)}});var mr=d((An,pr)=>{"use strict";var A=et();A.createWebSocketStream=ir();A.Server=_r();A.Receiver=Ve();A.Sender=He();A.WebSocket=A;A.WebSocketServer=A.Server;pr.exports=A});var Sr=d((Dn,yr)=>{var gr=require("fs"),rt={read:(e,t,r,s)=>{gr.stat(e,(n,i)=>{if(n)return t&&t({error:n});if(!i.isFile())return t&&t(!1);gr.readFile(e,(o,a)=>{if(o)return t&&t({error:o});if(s)return t&&t(a.toString("base64"));if(!r)return t&&t(a.toString());try{let c=a.toString(),l=JSON.parse(c);return t&&t(l)}catch{return t&&t({error:"Invalid JSON file."})}})})}},sn={auto:(e,t)=>{let r={anchor:"",file:"config.json",address:"",port:0};switch(e.length){case 0:rt.read(r.file,s=>{if(s.error)return t&&t({error:`Failed to load default config file "${r.file}"`});for(var n in r)s[n]!==void 0&&(r[n]=s[n]);return r.data=s,t&&t(r)},!0);break;case 1:rt.read(e[0],s=>{if(s.error)return t&&t({error:"Failed to load config file."});for(var n in r)s[n]!==void 0&&(r[n]=s[n]);return r.data=s,t&&t(r)},!0);break;case 2:rt.read(e[0],s=>{if(s.error)return t&&t({error:"Failed to load config file."});for(var n in r)s[n]!==void 0&&(r[n]=s[n]);return r.data=s,r.address=e[1],t&&t(r)},!0);break;default:break}},number:(e,t,r)=>{},string:(e,t,r)=>{},SS58:(e,t)=>{},anchor:(e,t)=>{},u32:(e,t)=>{},isArr:e=>{let t={type:"",isArr:!1}}};yr.exports=sn.auto});var nt=d((Mn,xr)=>{var st={stamp:()=>new Date().getTime(),rand:(e,t)=>Math.round(Math.random()*(e-t)+t),char:(e,t)=>{e=e||7,t=t||"";for(let r=0;r<e;r++)t+=r%2?String.fromCharCode(st.rand(65,90)):String.fromCharCode(st.rand(97,122));return t},shorten:(e,t)=>(t===void 0&&(t=10),e.substr(0,t)+"..."+e.substr(e.length-t,t))};xr.exports=st});var ot=d((Bn,vr)=>{var it={error:"\x1B[31m%s\x1B[0m",success:"\x1B[36m%s\x1B[0m",primary:"\x1B[33m%s\x1B[0m",dark:"\x1B[90m%s\x1B[0m"},nn={output:(e,t,r)=>{let s=()=>new Date().toLocaleString();if(!t||!it[t]){if(r)return console.log(e);console.log(`[${s()}] `+e)}else{if(r)return console.log(it[t],e);console.log(it[t],`[${s()}] `+e)}}};vr.exports=nn});var Nr=d((qn,br)=>{var G={},Ce=null,Er={auto:()=>{Ce===null&&(console.log("Ready to recover the history data"),Ce=setInterval(()=>{},2e3))}};br.exports={message:(e,t,r)=>{Ce===null&&Er.auto(),G[t]||(G[t]=[]),G[t].push({from:e,to:t,content:r,stamp:new Date().getTime()})},mine:e=>(Ce===null&&Er.auto(),G[e]?G[e]:[]),clean:(e,t)=>{if(!G[e])return!1;for(let r=0;r<t;r++)G[e].pop();return!0}}});var kr=d((Wn,wr)=>{var Tr=nt(),{output:Q}=ot(),Fn=Nr(),de={},j={},he={};var Or={message:(e,t)=>{j[e.to]?V.send(e,j[e.to]):console.log("Not active, ready to push history")},notice:(e,t)=>{let r={};r.type="notice",r.msg=e.msg,r.method=e.method,t!==void 0&&(r.method.callback=t),j[e.to]?V.success(r,j[e.to]):console.log("Not active")},announce:(e,t)=>{let r={};r.type="announce"}},V={send:(e,t,r)=>{if(!de[t])return!1;r!==void 0&&(e.order=r),de[t].websocket.send(JSON.stringify(e))},success:(e,t,r)=>{e.success=!0,V.send(e,t,r)},failed:(e,t,r)=>{e.type="error",V.send(e,t,r)},decode:e=>{if(Array.isArray(e))for(let t=0;t<e.length;t++){let r=e[t];Or[r.action]?Or[r.action](r.params,r.callback?r.callback:void 0):console.log("success send directly")}else V.send(e,j[e.to])}};wr.exports={connection:(e,t)=>{let r=Tr.char(12);return de[r]={websocket:e,stamp:Tr.stamp(),status:1,IP:""},Q(`Client linked, uid: ${r} at ${new Date(de[r].stamp)}`,"success"),e.send(JSON.stringify({spam:r,act:"init"})),t&&t(r)},close:(e,t)=>{delete de[e];let r=he[e];delete he[e],delete j[r],Q(`Client removed, uid: ${e}`,"error")},error:e=>{Q(`Error: ${e}`,"error")},message:(e,t,r)=>{if(e.act==="active"){if(!e.acc)return Q(`Invalid active. request: ${JSON.stringify(e)}`,"error");he[t]=e.acc,j[e.acc]=t}else if(!he[t])return Q(`Unknown spam. request: ${JSON.stringify(e)}`,"error");let s=e.cat?e.cat:"chat",n=e.act;if(!r[s]||!r[s][n])return Q(`Unknown request: ${JSON.stringify(e)}, to ${t}`,"error");let i=r[s][n];delete e.act,delete e.cat;let o=i(e,he[t]);!o||o.error?V.failed(o,t,e.order):V.decode(o)}}});var Ie=d(($n,Ir)=>{var _e={message:{action:"message",params:{act:"chat",cat:"chat",msg:"CHAT_CONTENT",from:"SS58_ACCOUNT",group:"GROUP ID",to:"SS58_ACCOUNT"}},notice:{action:"notice",params:{act:"notice",cat:"chat",msg:{},from:"System",to:"SS58_ACCOUNT",method:{}}}},Cr={group:{id:"",group:[],status:1,create:0,update:0,notice:[],manager:"",founder:"",announce:{content:"",expired:0},permit:{free:!0,announce:!1},block:[],nick:""},account:{expired:0,block_stranger:!1},chat:{from:"",to:"",msg:"",expired:0},notice:{to:"",type:"",msg:"",expired:0,method:{act:"",cat:"",from:""}}},at={SYSTEM_INVALID_REQUEST:{error:"Invalid request.",code:41400},INPUT_MISSING_PARAMETERS:{error:"Missing parameters.",code:44001},INPUT_INVALID_ACCOUNT:{error:"Invalid SS58 account format.",code:44009},INPUT_INVALID_GROUP_ID:{error:"Invalid Group ID.",code:44100},INPUT_UNEXCEPT:{error:"Invalid Group ID.",code:44744}};Ir.exports={format:e=>Cr[e]?JSON.parse(JSON.stringify(Cr[e])):!1,task:e=>_e[e]?JSON.parse(JSON.stringify(_e[e])):!1,error:(e,t)=>at[e]?t?JSON.stringify(at[e]):JSON.parse(JSON.stringify(at[e])):!1,params:(e,t)=>!_e[e]||_e[e][t]?!1:JSON.parse(JSON.stringify(_e[e][t]))}});var lt=d((Gn,Pr)=>{var C={alive:0,notice:0,message:0,group:0};Pr.exports={count:e=>{let t=e||1;C.message=C.message+t},toast:e=>{let t=e||1;C.notice=C.notice+t},online:()=>{C.alive=C.alive+1},offline:()=>{C.alive>0&&(C.alive=C.alive-1)},status:()=>JSON.parse(JSON.stringify(C))}});var Ar=d((jn,Rr)=>{var{task:Pe,error:Lr}=Ie(),{online:on,offline:an,count:ln,toast:Ur,status:cn}=lt();Rr.exports={online:(e,t)=>{let r=cn(),s=Pe("notice");return s.params.msg={count:r.alive+1},s.params.to=t,on(),Ur(),[s]},to:(e,t)=>{if(!e.to||!e.msg)return Lr("INPUT_MISSING_PARAMETERS");let r=Pe("message");return r.params.type="message",r.params.msg=e.msg,r.params.to=e.to,r.params.from=t,delete r.params.group,ln(),[r]},offline:(e,t)=>{let r=Pe("notice");return r.params.msg="Be off-line.",r.params.to=t,an(),Ur(),[r]},block:(e,t)=>{let r=Pe("notice");r.params.msg={count:1}}}});var qr=d((Vn,Br)=>{var J={},I={},y={},Dr=null,ct={cache:{},hash:{},queue:{}},v={key:256,val:4096},Mr={remover:()=>{if(Dr!==null)return!1;Dr=setInterval(()=>{let e=new Date().getTime();console.log(`Remove timer : ${e}`);let t=parseInt(e*.001);for(var r in ct)if(ct[r][t]){let s=ct[r][t];switch(r){case"cache":for(let n=0;n<s.length;n++){let i=s[n];delete J[i]}break;case"hash":for(let n=0;n<s.length;n++){let i=s[n];delete I[i]}break;case"queue":for(let n=0;n<s.length;n++){let i=s[n];delete y[i]}break;default:break}}},900)},key_get:(e,t)=>{let r=typeof e;return r!=="string"&&r!=="number"||e.length>v.key?!1:J[e]?J[e]:null},key_set:(e,t,r)=>typeof e!="string"||e.length>v.key||JSON.stringify(t).length>v.val?!1:(J[e]=t,!0),key_ttl:(e,t)=>{},key_del:e=>{let t=typeof e;return t!=="string"&&t!=="number"||(t==="number"&&(e=""+e),e.length>v.key)?!1:J[e]?(delete J[e],!0):null},hash_get:(e,t)=>typeof e!="string"||typeof t!="string"||e.length>v.key||t.length>v.key?!1:!I[e]||!I[e][t]?null:I[e][t],hash_set:(e,t,r)=>typeof e!="string"||typeof t!="string"||e.length>v.key||t.length>v.key||JSON.stringify(r).length>v.val?!1:(I[e]||(I[e]={}),I[e][t]=r,!0),hash_ttl:(e,t)=>{},hash_count:e=>{},hash_all:e=>typeof e!="string"||e.length>v.key?!1:I[e]?I[e]:null,list_init:(e,t)=>{let r=typeof e;return r!=="string"||(r==="number"&&(e=""+e),e.length>v.key)?!1:t?(y[e]=[],!0):(y[e]!==void 0||(y[e]=[]),!0)},list_get:e=>{let t=typeof e;return t!=="string"||(t==="number"&&(e=""+e),e.length>v.key)||!y[e]?!1:y[e]},list_push:(e,t)=>Mr.list_init(e)?(y[e].push(t),!0):!1,list_pop:e=>{let t=typeof e;return t!=="string"&&t!=="number"||e.length>v.key||!y[e]?!1:(y[e].pop(),!0)},list_first:e=>{let t=typeof e;return t!=="string"&&t!=="number"||e.length>v.key||!y[e]?!1:y[e][0]},list_last:e=>{let t=typeof e;if(t!=="string"&&t!=="number"||e.length>v.key||!y[e])return!1;let r=y[e].length;return y[e][r-1]},list_len:e=>typeof e!="string"||(type==="number"&&(e=""+e),e.length>v.key)||!y[e]?!1:y[e].length,list_lpush:(e,t)=>{},list_shift:e=>{},list_ttl:(e,t)=>{},dump:()=>({cache:J,hash:I,queue:y})};Br.exports=Mr});var Wr=d((Jn,Fr)=>{var ft=nt(),S=qr(),{format:fn,task:O,error:b}=Ie(),{count:un,toast:pe}=lt(),hn="GD",ee={getGID:()=>{let e=hn+ft.char(10);return S.key_get(e)!==null?ee.getGID():e},validAccounts:e=>{for(let t=0;t<e.length;t++);return!0},validGID:e=>{},validNewAccount:(e,t)=>{for(let r=0;r<t.length;r++)if(e===t[r])return!1;return!0},validInAccount:(e,t)=>{for(let r=0;r<t.length;r++)if(e===t[r])return!0;return!1}};Fr.exports={create:(e,t)=>{if(console.log(`From group.js/chat, input: ${JSON.stringify(e)}`),!ee.validAccounts(e.list))return b("INPUT_INVALID_ACCOUNT");let r=ee.getGID(),s=fn("group");s.id=r,s.update=ft.stamp(),s.create=ft.stamp(),s.group=e.list,s.manager=t,s.founder=t,S.key_set(r,s);let n=O("notice");return n.params.msg={id:r},n.params.to=t,n.params.method={act:"create",cat:"group"},e.callback&&(n.callback=e.callback),[n]},detail:(e,t)=>{let r=e.id,s=S.key_get(r);if(s===null)return b("INPUT_INVALID_GROUP_ID");if(!ee.validInAccount(t,s.group))return b("INPUT_UNEXCEPT");let n=O("notice");return n.params.msg=s,n.params.to=t,n.params.method={act:"detail",cat:"group"},e.callback&&(n.callback=e.callback),[n]},join:(e,t)=>{console.log(`From group.js/join, input: ${JSON.stringify(e)}`);let r=e.id,s=S.key_get(r);if(!ee.validNewAccount(e.account,s.group))return b("INPUT_UNEXCEPT");s.group.push(e.account),S.key_set(r,s);let n=[];for(let i=0;i<s.group.length;i++){let o=s.group[i],a=O("notice");a.params.msg=`${e.account} join to chat`,a.params.to=o,a.params.method={act:"join",cat:"group"},n.push(a)}return pe(n.length),n},leave:(e,t)=>{console.log(`From group.js/leave, input: ${JSON.stringify(e)}`);let r=e.id,s=S.key_get(r);if(!ee.validInAccount(e.account,s.group))return b("INPUT_UNEXCEPT");let n=[],i=[];for(let o=0;o<s.group.length;o++){let a=s.group[o],c=O("notice");c.params.msg={from:t,group:r},c.params.to=a,c.params.method={act:"leave",cat:"group"},n.push(c),a!==e.account&&i.push(a)}return s.group=i,S.key_set(r,s),pe(n.length),n},divert:(e,t)=>{console.log(`From group.js/divert, input: ${JSON.stringify(e)}`);let r=e.id,s=S.key_get(r);if(!s||s.manager!==t)return b("INPUT_UNEXCEPT");s.manager=e.manager,S.key_set(r,s);let n=[];for(let a=0;a<s.group.length;a++){let c=s.group[a],l=O("notice");l.params.msg=`Group manager is ${e.manager} now`,l.params.to=c,l.params.method={act:"devert",cat:"group"},n.push(l)}let i=O("notice");i.params.msg="You are the new group manager",i.params.to=e.manager,i.params.method={act:"devert",cat:"group"},n.push(i);let o=O("notice");return o.params.msg="You are not the group manager",o.params.to=t,o.params.method={act:"devert",cat:"group"},n.push(o),pe(n.length),n},deport:(e,t)=>{let r=e.id,s=S.key_get(r);if(!s||s.manager!==t)return b("INPUT_UNEXCEPT");s.block.push(e.account),S.key_set(r,s);let n=O("notice");return n.params.msg=`${e.account} is added to block list`,n.params.to=t,n.params.method={act:"deport",cat:"group"},[n]},recover:(e,t)=>{let r=e.id,s=S.key_get(r);if(!s||s.manager!==t)return b("INPUT_UNEXCEPT");let n=[];for(let o=0;o<s.block.length;o++)s.block[o]!==e.account&&n.push(s.block[o]);s.block=n,S.key_set(r,s);let i=O("notice");return i.params.msg=`${e.account} is removed from block list`,i.params.to=t,i.params.method={act:"recover",cat:"group"},[i]},destory:(e,t)=>{console.log(`From group.js/destory, input: ${JSON.stringify(e)}`);let r=e.id,s=S.key_get(r);if(!s||s.manager!==t)return b("INPUT_UNEXCEPT");S.key_del(r);let n=[];for(let i=0;i<s.group.length;i++){let o=s.group[i],a=O("notice");a.params.msg="Group destoried",a.params.to=o,a.params.method={act:"destory",cat:"group"},n.push(a)}return pe(n.length),n},message:(e,t)=>{console.log(`From group.js/chat, input: ${JSON.stringify(e)}`);let r=e.to,s=S.key_get(r);if(s===null)return b("INPUT_INVALID_GROUP_ID");let n=[];for(let i=0;i<s.group.length;i++){let o=s.group[i];if(o===t)continue;let a=O("message");a.params.cat="group",a.params.type="message",a.params.msg=e.msg,a.params.to=o,a.params.from=t,a.params.group=r,a.params.method={act:"message",cat:"group"},n.push(a)}return un(n.length),n},notice:(e,t)=>{console.log(`From group.js/notice, input: ${JSON.stringify(e)}`);let r=e.to,s=S.key_get(r);if(s===null)return b("INPUT_INVALID_GROUP_ID");let n=[];for(let i=0;i<s.group.length;i++){let o=s.group[i];if(o===t)continue;let a=O("notice");a.params.msg=e.msg,a.params.to=o,n.push(a)}return pe(n.length),n},announce:(e,t)=>{}}});var{WebSocketServer:dn}=mr(),_n=Sr(),Le=kr(),{output:H}=ot(),me=Ar(),P=Wr(),{error:pn}=Ie(),mn={chat:{chat:me.to,to:me.to,active:me.online,notice:null,offline:me.offline,block:me.block},group:{create:P.create,detail:P.detail,join:P.join,leave:P.leave,divert:P.divert,deport:P.deport,recover:P.recover,destory:P.destory,chat:P.message,notice:P.notice},veritfy:{init:null,reg:null,token:null},debug:{status:null}};_n(process.argv.slice(2),e=>{let r=e.data.server.port;try{let s=new dn({port:r});H(`W3OS IMS and GCS server start on ${r}.`,"dark",!0),H(`ws://127.0.0.1:${r}`,"primary",!0),s.on("connection",(n,i,o)=>{Le.connection(n,a=>{n.on("close",c=>{Le.close(a,c)}),n.on("error",c=>{Le.error(c)}),n.on("message",c=>{let l=c.toString();if(!l)return H("Empty request.","error");try{let f=JSON.parse(l);if(!f.spam)return H(pn("SYSTEM_INVALID_REQUEST"),"error");if(f.spam!==a)return H("Invalid spam.","error");delete f.spam,Le.message(f,a,mn)}catch(f){H(`Error: ${f}`,"error")}})})})}catch{H(`Failed to create Websocket server on ${r}.`,"error",!0)}});
//!important, the module of IMS and GCS will return the list of actions
//!important, client here to check the status and decode the task to do real work of network
//!important, all standard format here, three parts: storage data structure, internal task format, error
//!important, be very careful to modify here.
//!important, This is a memory DB, the storage is galobal
